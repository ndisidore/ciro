[tools]
go = "1.25"
"golangci-lint" = "2.8.0"

[tasks.build]
description = "Build the cicada CLI binary"
run = "mkdir -p ./bin && go build -o ./bin/cicada ./cmd/cicada"

[tasks.test]
description = "Run all tests"
run = "go test -v -race ./..."

[tasks.vet]
description = "Run go vet"
run = "go vet ./..."

[tasks.lint]
description = "Run golangci-lint"
run = 'golangci-lint run --config=".golangci.yaml"'

[tasks.fmt]
description = "Format code"
run = "gofmt -w ."

[tasks."fmt:check"]
description = "Check formatting"
run = 'test -z "$(gofmt -l .)"'

[tasks.validate]
description = "Validate a KDL pipeline file"
usage = 'arg "<file>" help="KDL pipeline file"'
run = "go run ./cmd/cicada validate ${usage_file?}"

[tasks.run]
description = "Run a KDL pipeline"
usage = 'arg "<file>" help="KDL pipeline file"'
run = "go run ./cmd/cicada run ${usage_file?}"

[tasks.ci]
description = "Run all CI checks"
depends = ["build", "fmt:check", "vet", "lint", "test"]
